<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>RNC Slideshow</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        padding: 20px;
    }

    #rnc-slideshow {
        max-width: 1000px;
        margin: 0 auto;
    }

    #slide-card {
        display: flex;
        gap: 20px;
        align-items: flex-start;
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 6px 18px rgba(0,0,0,.12);
        background: #fff;
    }

    #image-wrap {
        flex: 0 0 460px;
        height: 300px;
        overflow: hidden;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f4f4f4;
    }

    #slide-image {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }

    button {
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid #ddd;
        background: #fff;
        cursor: pointer;
    }

    #controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 12px;
        margin-top: 12px;
    }
</style>
</head>

<body>

<div id="rnc-slideshow">
  <div id="slide-card">
    <div id="image-wrap">
      <img id="slide-image" src="" alt="Imagem RNC">
    </div>

    <div style="flex:1; min-width:260px;">
      <h3 id="titulo" style="margin:0 0 8px 0; font-size:20px;"></h3>
      <div style="font-size:14px; color:#333; line-height:1.4;">
        <p><strong>Origem:</strong> <span id="origem"></span></p>
        <p><strong>Responsável (apontamento):</strong> <span id="resp_apontamento"></span></p>
        <p><strong>Responsável (plano de ação):</strong> <span id="resp_plano"></span></p>
        <p><strong>Prazo (dias):</strong> <span id="prazo"></span></p>
      </div>
    </div>
  </div>

  <div id="controls">
    <button id="prevBtn">Anterior</button>
    <div id="counter" style="font-size:14px;color:#555;"></div>
    <button id="nextBtn">Próximo</button>
  </div>
</div>

<script>
(function(){

  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTsXEYtBupLJfZ7aBF6bmnNYhENOJqnh4uaTPhA__e1qRomxKDO8L_WUx2oi1-IGwM9rkIn7_U-8bUj/pub?output=csv";
  const INTERVAL_MS = 10000;

  let records = [];
  let idx = 0;
  let timer = null;

  const imgEl = document.getElementById('slide-image');
  const tituloEl = document.getElementById('titulo');
  const origemEl = document.getElementById('origem');
  const respApEl = document.getElementById('resp_apontamento');
  const respPlanoEl = document.getElementById('resp_plano');
  const prazoEl = document.getElementById('prazo');
  const counterEl = document.getElementById('counter');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  function driveUrlToDirect(url){
    if(!url) return "";
    const match = url.match(/[-\w]{25,}/);
    if(match){
      return "https://drive.google.com/uc?export=view&id=" + match[0];
    }
    return url;
  }

  function parseCSVLine(line) {
    const parts = [];
    let current = "";
    let insideQuotes = false;

    for (let i = 0; i < line.length; i++) {
      const c = line[i];

      if (c === '"' && line[i+1] === '"') {
        current += '"';
        i++;
      } else if (c === '"') {
        insideQuotes = !insideQuotes;
      } else if (c === "," && !insideQuotes) {
        parts.push(current);
        current = "";
      } else {
        current += c;
      }
    }
    parts.push(current);
    return parts;
  }

  function loadCSV(){
    fetch(CSV_URL)
      .then(r => r.text())
      .then(text => {

        const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
        const headers = parseCSVLine(lines[0]);

        const colImg = headers.findIndex(h => h.toLowerCase().includes("link"));
        const colTitulo = headers.findIndex(h => h.toLowerCase().includes("titulo"));
        const colOrigem = headers.findIndex(h => h.toLowerCase().includes("origem"));
        const colRespAp = headers.findIndex(h => h.toLowerCase().includes("apontamento"));
        const colRespPlano = headers.findIndex(h => h.toLowerCase().includes("plano"));
        const colPrazo = headers.findIndex(h => h.toLowerCase().includes("prazo"));

        records = lines.slice(1).map(line => {
          const parts = parseCSVLine(line);

          return {
            imagem: driveUrlToDirect(parts[colImg] || ""),
            titulo: parts[colTitulo] || "",
            origem: parts[colOrigem] || "",
            resp_apontamento: parts[colRespAp] || "",
            resp_plano: parts[colRespPlano] || "",
            prazo: parts[colPrazo] || ""
          };
        }).filter(r => r.titulo || r.imagem);

        idx = 0;
        renderSlide(idx);
        startAuto();
      })
      .catch(err => {
        console.error("Erro CSV:", err);
      });
  }

  function renderSlide(i){
    if(records.length === 0) return;
    if(i < 0) i = records.length - 1;
    if(i >= records.length) i = 0;

    idx = i;
    const r = records[idx];

    imgEl.src = r.imagem;
    tituloEl.textContent = r.titulo;
    origemEl.textContent = r.origem;
    respApEl.textContent = r.resp_apontamento;
    respPlanoEl.textContent = r.resp_plano;
    prazoEl.textContent = r.prazo;
    counterEl.textContent = (idx+1) + " / " + records.length;
  }

  function nextSlide(){
    renderSlide(idx + 1);
  }
  function prevSlide(){
    renderSlide(idx - 1);
  }

  function startAuto(){
    stopAuto();
    timer = setInterval(nextSlide, INTERVAL_MS);
  }

  function stopAuto(){
    if(timer) clearInterval(timer);
  }

  nextBtn.addEventListener("click", () => { nextSlide(); startAuto(); });
  prevBtn.addEventListener("click", () => { prevSlide(); startAuto(); });

  loadCSV();

})();
</script>

</body>
</html>
